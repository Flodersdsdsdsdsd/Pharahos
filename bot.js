// ########################################################################
// #          _ _ _____    _  __     _          _                         #
// #         (_|_)_   _|__| |/ /__ _| |__  _ __| |__   __ _               #
// #         | | | | ||_  / ' // _` | '_ \| '__| '_ \ / _` |              #
// #         | | | | | / /| . \ (_| | | | | |  | |_) | (_| |              #
// #         |_|_| |_|/___|_|\_\__,_|_| |_|_|  |_.__/ \__,_|              #
// #                                                                      #
// #                                                                      #
// #                                                                      #
// #                                                                      #
// #                                                                      #
// #                                                                      #
// ########################################################################

const Discord = require('discord.js');
const child_process = require("child_process");
const moment = require('moment');
const request = require('request');
const dateFormat = require('dateformat');
const fs = require('fs');
const queue = new Map();
const client = new Discord.Client();
const adminprefix = "k!";
const devs = ['286088294234718209'];
const prefix = '.'

client.on('ready', () => {
	// - 
  client.user.setActivity("Pharahos 1K",{type: 'WATCHING'});
  console.log('â•”[â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•]â•—');
  console.log('')
  console.log('            â•”[â•â•â•â•â•â•â•â•â•â•â•â•]â•—')
  console.log('              Bot Is Online')
  console.log('            â•š[â•â•â•â•â•â•â•â•â•â•â•â•]â•')
  console.log('')
  console.log(`Logged in as ${client.user.tag}!`);
  console.log('')
  console.log(`servers! [ " ${client.guilds.size} " ]`);
  console.log('')
  console.log(`Users! [ " ${client.users.size} " ]`);
  console.log('')
  console.log('â•š[â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•]â•')
});

  client.on('message', message => {
if(message.content == '<@465920139770986506>') {
message.channel.startTyping()
setTimeout(() => { 
message.channel.stopTyping()
}, 3000);
}
});

const version = ['v1.2']
var initcmd = ['.']

   client.on("message", message => {
      if(message.author.id !== '286088294234718209') return;
    if (message.content === initcmd +"newsystem1") {
     const embed = new Discord.RichEmbed()
         .setColor("36393f")
         .setDescription(`**
â”â”â”â”â”³â”“â•‹â•‹â•‹â•‹â•‹â•‹â•‹â•‹â•‹â”â”“
â”ƒâ”â”â”“â”ƒâ”ƒâ•‹â•‹â•‹â•‹â•‹â•‹â•‹â•‹â•‹â”ƒâ”ƒ
â”ƒâ”—â”â”›â”ƒâ”—â”â”³â”â”â”³â”â”³â”â”â”«â”—â”â”³â”â”â”³â”â”â”“
â”ƒâ”â”â”â”«â”â”“â”ƒâ”â”“â”ƒâ”â”«â”â”“â”ƒâ”â”“â”ƒâ”â”“â”ƒâ”â”â”«
â”ƒâ”ƒâ•‹â•‹â”ƒâ”ƒâ”ƒâ”ƒâ”â”“â”ƒâ”ƒâ”ƒâ”â”“â”ƒâ”ƒâ”ƒâ”ƒâ”—â”›â”£â”â”â”ƒ
â”—â”›â•‹â•‹â”—â”›â”—â”»â”›â”—â”»â”›â”—â”›â”—â”»â”›â”—â”»â”â”â”»â”â”â”›
Bot Version : ${version}
Developer By : <@286088294234718209>
**`)
   message.channel.send({embed});

   }
   });

client.on('message', message => {
      if(message.author.id !== '286088294234718209') return;
    if (message.content === initcmd +'newsystem2') {
        message.channel.sendFile("https://media.discordapp.net/attachments/480059231492374531/480059818279960576/image-16-1.png?width=866&height=47", "kahrba.png")
    }
});

client.on('message', message => {
    if (message.content === initcmd +'newsystem3') {
        message.channel.send('**Ø§Ø®ØªØ§Ø± Ø§ÙŠ ÙØ¦Ø© Ø§Ù†Øª.."**')
    }
});

client.on('message', message => {
    if (message.content === initcmd +'newsystem4') {
        message.channel.send('**Ø®Ø¯ Ø§Ù„Ø±ØªØ¨Ø© Ø§Ù„ÙŠ ØªØ¨ÙŠØ© Ù…Ù† Ø§Ù„Ø§Ø³ÙÙ„ ÙÙ‚Ø· Ø§Ø¶ØºØ· Ø¹Ù„ÙŠ Ø§Ù„Ø§ÙŠÙ…ÙˆØ¬ÙŠ ÙˆÙÙŠ Ø­Ø§Ù„Ø© ØªØ±ÙŠØ¯ Ø§Ø²Ø§Ù„Ø© Ø´ÙŠÙ„ Ø§Ù„Ø§ÙŠÙ…ÙˆØ¬ÙŠ.."**')
    }
});


//Settings!
const yourID = "286088294234718209"; //Instructions on how to get this: https://redd.it/40zgse
const setupCMD = ".startrolesystem"
let initialMessage = ` `;
const roles = ["Games | Ù‚ÙŠÙ…Ø²", "Swalff | Ø³ÙˆØ§Ù„Ù", "Creative Destruction | ÙƒØ±ÙŠØªÙ Ø¯ÙŠØ³ØªØ±ÙƒØ´Ù†", "Fortnite | ÙÙˆØ±Øª Ù†Ø§ÙŠØª", "Black Squad | Ø¨Ù„Ø§Ùƒ Ø§Ø³ÙƒÙˆØ§Ø¯", "Roblox | Ø±ÙˆØ¨Ù„ÙˆÙƒØ³", "Minecraft | Ù…Ø§ÙŠÙ† ÙƒØ±Ø§ÙØª", "Crossfire | ÙƒØ±ÙˆØ³ ÙØ§ÙŠØ±", "Mta | Ø¬Ø±Ø§Ù†Ø¯ Ø§ÙˆÙ† Ù„Ø§ÙŠÙ†", "Rainbow Six Siege | Ø±ÙŠÙ†Ø¨Ùˆ 6 Ø³ÙŠØ¬", "League Of Legends | Ù„ÙŠØ¬Ùˆ Ø§ÙˆÙ Ù„ÙŠØ¬ÙŠÙ†Ø¯Ø²", "Knives Out | ÙƒÙ†Ø§ÙŠÙØ³ Ø§ÙˆØª", "Battlefield | Ø¨Ø§ØªÙ„ ÙÙŠÙ„Ø¯", "PUBG | Ø¨Ø§Ø¨Ø¬ÙŠ" ,"Agario | Ø§Ù‚Ø§Ø±ÙŠÙˆ", "Iron Sight | Ø§ÙŠØ±ÙˆÙ† Ø³Ø§ÙŠØª", "Rust | Ø±Ø§Ø³Øª", "Brawlhalla | Ø¨Ø±ÙˆÙ‡Ù„Ø§"];
const reactions = ["ğŸ¦", "ğŸ¦", "ğŸ”«", "ğŸ”«", "â›", "ğŸ›¡", "ğŸš“", "ğŸ”«", "â›", "ğŸ›¡", "ğŸš“", "ğŸ”«", "â›", "ğŸ›¡", "ğŸš“", "ğŸ”«", "â›", "ğŸ›¡", "ğŸš“"];

//If there isn't a reaction for every role, scold the user!
if (roles.length !== reactions.length) throw "Roles list and reactions list are not the same length!";

//Function to generate the role messages, based on your settings
function generateMessages(){
    var messages = [];
    messages.push(initialMessage);
    for (let role of roles) messages.push(` **"${role}"**`); //Ù„Ø§ ØªØºÙŠØ± Ù‡Ø°Ø§
    return messages;
}


client.on("message", message => {
    if (message.author.id == yourID && message.content.toLowerCase() == setupCMD){
        var toSend = generateMessages();
        let mappedArray = [[toSend[0], false], ...toSend.slice(1).map( (message, idx) => [message, reactions[idx]])];
        for (let mapObj of mappedArray){
            message.channel.send(mapObj[0]).then( sent => {
                if (mapObj[1]){
                  sent.react(mapObj[1]);
                }
            });
        }
    }
})


client.on('raw', event => {
    if (event.t === 'MESSAGE_REACTION_ADD' || event.t == "MESSAGE_REACTION_REMOVE"){

        let channel = client.channels.get(event.d.channel_id);
        let message = channel.fetchMessage(event.d.message_id).then(msg=> {
        let user = msg.guild.members.get(event.d.user_id);

        if (msg.author.id == client.user.id && msg.content != initialMessage){

            var re = `\\*\\*"(.+)?(?="\\*\\*)`;
            var role = msg.content.match(re)[1];

            if (user.id != client.user.id){
                var roleObj = msg.guild.roles.find('name', role);
                var memberObj = msg.guild.members.get(user.id);

                if (event.t === "MESSAGE_REACTION_ADD"){
                    memberObj.addRole(roleObj)
                } else {
                    memberObj.removeRole(roleObj);
                }
            }
        }
        })

    }
});

/////


client.on('message', msg => {
    if (msg.content == '#join-room') {
        if (msg.member.voiceChannel) {

     if (msg.member.voiceChannel.joinable) {
         msg.member.voiceChannel.join();
     }
    }
}
})


client.on('message', message => {
if(message.content === adminprefix + "restart") {
      if (!devs.includes(message.author.id)) return;
          message.channel.send(`âš ï¸ **Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ø°ÙŠ Ø§Ø¹Ø§Ø¯ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª ${message.author.username}**`);
        console.log(`âš ï¸ Ø¬Ø§Ø±ÙŠ Ø§Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª... âš ï¸`);
        client.destroy();
        child_process.fork(__dirname + "/bot.js");
        console.log(`ØªÙ… Ø§Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª`);
    }
  
  }); // By Kahrba



client.on('voiceStateUpdate', (old, now) => {
  const channel = client.channels.get('480101846975774730');
  const currentSize = channel.guild.members.filter(m => m.voiceChannel).size;
  const size = channel.name.match(/\[\s(\d+)\s\]/);
  if (!size) return channel.setName(`â¥ Pharahos Online [ ${currentSize} ].`);
  if (currentSize !== size) channel.setName(`â¥ Pharahos Online [ ${currentSize} ].`);
});




  
client.on('message' , message => {
      if(message.author.bot) return;
     
      if(message.content.startsWith(prefix + "rolebc")) {
        if (!message.member.hasPermission("ADMINISTRATOR"))  return;
        let args = message.content.split(" ").slice(2);
     var codes = args.join(' ')
       
        if(!codes) {
          message.channel.send("Ù‚Ù… Ø¨ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø© | !rolebc ``@Role`` message")
            return;
        }
     
     
              var role = message.mentions.roles.first();
                if(!role) {
                  message.reply("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±ØªØ¨Ø© Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù…")
                    return;
                }
            message.guild.members.filter(m => m.roles.get(role.id)).forEach(n => {
              n.send(
              "**" + "Ø§Ù„Ø³ÙŠØ±ÙØ± :" + "\n" +
              `${message.guild.name}` + "\n" +
              "Ø§Ù„Ù…Ø±Ø³Ù„ :" + "\n" +
              `${message.author.tag}` + "\n" +
              "Ø§Ù„Ø±Ø³Ø§Ù„Ø© :" + "\n" +
              `${codes}` + "**"
              )
            })
            message.channel.send(`Ù„Ù‚Ø¯ ØªÙ… Ø§Ø±Ø³Ø§Ù„ Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù‰ ${message.guild.members.filter(m => m.roles.get(role.id)).size} Ø¹Ø¶Ùˆ`)
        }
    });



client.on('message', message => {
                    var prefix = "p";

           if (message.content.startsWith(prefix + "id")) {
                     if(!message.channel.guild) return message.reply(`Ù‡Ø°Ø§ Ø§Ù„Ø£Ù…Ø± ÙÙ‚Ø· Ù„ Ø§Ù„Ø³ÙŠØ±ÙØ±Ø§Øª âŒ`);

                message.guild.fetchInvites().then(invs => {
      let member = client.guilds.get(message.guild.id).members.get(message.author.id);
      let personalInvites = invs.filter(i => i.inviter.id === message.author.id);
      let inviteCount = personalInvites.reduce((p, v) => v.uses + p, 0);
      var moment = require('moment');
      var args = message.content.split(" ").slice(1);
let user = message.mentions.users.first();
var men = message.mentions.users.first();
 var heg;
 if(men) {
     heg = men
 } else {
     heg = message.author
 }
var mentionned = message.mentions.members.first();
  var h;
 if(mentionned) {
     h = mentionned
 } else {
     h = message.member
 }
        moment.locale('ar-TN');
      var id = new  Discord.RichEmbed()
       
    .setColor("#0a0909")
    .setAuthor(message.author.username, message.author.avatarURL) 
.addField(': Ø¯Ø®ÙˆÙ„Ùƒ Ù„Ø¯ÙŠØ³ÙƒÙˆØ±Ø¯ Ù‚Ø¨Ù„', `${moment(heg.createdTimestamp).format('YYYY/M/D HH:mm:ss')} **\n** \`${moment(heg.createdTimestamp).fromNow()}\`` ,true) 
.addField(': Ø§Ù†Ø¶Ù…Ø§Ù…Ùƒ Ù„Ø³ÙŠØ±ÙØ± Ù‚Ø¨Ù„', `${moment(h.joinedAt).format('YYYY/M/D HH:mm:ss')} \n \`${moment(h.joinedAt).fromNow()}\``, true)
.addField(': Ø¹Ø¯Ø¯ Ø§Ù„Ø¯Ø¹ÙˆØ§Øª', inviteCount,false)
.setFooter("-")  
    message.channel.sendEmbed(id);
})
}
    

         
     });

  
client.on('message', message => {
  if(!message.channel.guild) return;
if(message.content.startsWith('pbc')) {
if(!message.channel.guild) return message.channel.send('**Ù‡Ø°Ø§ Ø§Ù„Ø£Ù…Ø± ÙÙ‚Ø· Ù„Ù„Ø³ÙŠØ±ÙØ±Ø§Øª**').then(m => m.delete(5000));
if(!message.member.hasPermission('ADMINISTRATOR')) return      message.channel.send('**Ù„Ù„Ø£Ø³Ù Ù„Ø§ ØªÙ…ØªÙ„Ùƒ ØµÙ„Ø§Ø­ÙŠØ©** `ADMINISTRATOR`' );
let args = message.content.split(" ").join(" ").slice(2 + prefix.length);
let copy = "Dragon";
let request = `Requested By ${message.author.username}`;
if (!args) return message.reply('**ÙŠØ¬Ø¨ Ø¹Ù„ÙŠÙƒ ÙƒØªØ§Ø¨Ø© ÙƒÙ„Ù…Ø© Ø§Ùˆ Ø¬Ù…Ù„Ø© Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ø±ÙˆØ¯ÙƒØ§Ø³Øª**');message.channel.send(`**Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø±Ø³Ø§Ù„Ùƒ Ø§Ù„Ø¨Ø±ÙˆØ¯ÙƒØ§Ø³ØªØŸ \nÙ…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¨Ø±ÙˆØ¯ÙƒØ§Ø³Øª:** \` ${args}\``).then(msg => {
msg.react('âœ…')
.then(() => msg.react('âŒ'))
.then(() =>msg.react('âœ…'))

let reaction1Filter = (reaction, user) => reaction.emoji.name === 'âœ…' && user.id === message.author.id;
let reaction2Filter = (reaction, user) => reaction.emoji.name === 'âŒ' && user.id === message.author.id;
let reaction1 = msg.createReactionCollector(reaction1Filter, { time: 12000 });
let reaction2 = msg.createReactionCollector(reaction2Filter, { time: 12000 });
reaction1.on("collect", r => {
message.channel.send(`â˜‘ | Done ... The Broadcast Message Has Been Sent For ${message.guild.members.size} Members`).then(m => m.delete(5000));
message.guild.members.forEach(m => {
var bc = new
Discord.RichEmbed()
.setColor('RANDOM')
.setTitle('Broadcast')
.addField('Server', message.guild.name)
.addField('Sender', message.author.username)
.addField('Message', args)
.setThumbnail(message.author.avatarURL)
.setFooter(copy, client.user.avatarURL);
m.send({ embed: bc })
msg.delete();
})
})
reaction2.on("collect", r => {
message.channel.send(`**Broadcast Canceled.**`).then(m => m.delete(5000));
msg.delete();
})
})
}
});


client.on('message', message => {
if(message.content.startsWith(prefix + 'move all')) {
 if (!message.member.hasPermission("MOVE_MEMBERS")) return message.channel.send('**Ù„Ø§ÙŠÙˆØ¬Ø¯ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ø³Ø­Ø¨ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡**');
   if(!message.guild.member(client.user).hasPermission("MOVE_MEMBERS")) return message.reply("**Ù„Ø§ÙŠÙˆØ¬Ø¯ Ù„Ø¯ÙŠ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø³Ø­Ø¨**");
if (message.member.voiceChannel == null) return message.channel.send(`**Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ø±ÙˆÙ… ØµÙˆØªÙŠ**`)
 var author = message.member.voiceChannelID;
 var m = message.guild.members.filter(m=>m.voiceChannel)
 message.guild.members.filter(m=>m.voiceChannel).forEach(m => {
 m.setVoiceChannel(author)
 })
 message.channel.send(`:white_check_mark: **ØªÙ… Ø³Ø­Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ø¥Ù„ÙŠÙƒ**`)


 }
   });
   
   
client.on('message', message => {
  if (message.author.bot) return;
  if (!message.content.startsWith(prefix)) return;

  let command = message.content.split(" ")[0];
  command = command.slice(prefix.length);

  let args = message.content.split(" ").slice(1);



if (command == "say") {
let rank = message.guild.member(message.author).roles.find('name', '.');
if (!rank) return message.reply('Ø§Ù†Øª Ù„Ø§ ØªÙ…ØªÙ„Ùƒ Ø§Ù„Ø±ØªØ¨Ù‡ Ø§Ù„Ù…Ø®ØµØµÙ‡ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø§Ù…Ø±')
  message.channel.send(args.join("  "))
    message.delete();
  }
});
//


var jimp = require('jimp')

client.on('ready', () => {
  console.log(`Logged in as ${client.user.tag}!`);
});

client.on('guildMemberAdd', member => {

    const channel = member.guild.channels.find('name', 'txt');
  
    const millis = new Date().getTime() - member.user.createdAt.getTime();
    const now = new Date();
    const createdAt = millis / 1000 / 60 / 60 / 24;




  
    const embed = new Discord.RichEmbed()
    
    .setColor("#1f0707")
    .setDescription(`**ØªØ§Ø±ÙŠØ® Ø¯Ø®ÙˆÙ„Ùƒ Ù„Ù„Ø¯Ø³ÙƒÙˆØ±Ø¯ Ù…Ù†Ø° ${createdAt.toFixed(0)} ÙŠÙˆÙ…**`)
    .setAuthor(member.user.tag, member.user.avatarURL);
    channel.sendEmbed(embed);

  
});



client.on('message', async message => {
    let args = message.content.split(" ");
    let command = args[0];

    if(command === 'Ø¨Ø§Ù†') {
      if(!message.member.hasPermission("BAN_MEMBERS")) return message.reply('Ø§Ù†Øª Ù„Ø§ ØªÙ…Ù„Ùƒ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù„Ø§Ø²Ù…Ø©').then(msg => {
        msg.delete(3500);
        message.delete(3500);
      });

      if(!message.guild.member(client.user).hasPermission("BAN_MEMBERS")) return message.reply('Ø§Ù†Ø§ Ù„Ø§ Ø§Ù…Ù„Ùƒ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù„Ø§Ø²Ù…Ø©. ÙŠØ­Ø¨ ØªÙˆÙØ± ØµÙ„Ø§Ø­ÙŠØ§Øª `Ban Members , Embed Links`').then(msg => {
        msg.delete(3500);
        message.delete(3500);
      });

      let mention = message.mentions.members.first();
      if(!mention) return message.reply('**Ù…Ù†Ø´Ù† Ø¹Ø¶Ùˆ Ù„Ø·Ø±Ø¯Ù‡**').then(msg => {
        msg.delete(3500);
        message.delete(3500);
      });
      if(mention.highestRole.position >= message.guild.member(message.author).highestRole.positon) return message.reply('**Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø·Ø±Ø¯ Ø´Ø®Øµ Ø±ØªØ¨ØªÙ‡ Ø§Ø¹Ù„Ù‰ Ù…Ù†Ùƒ**').then(msg => {
        msg.delete(3500);
        message.delete(3500);
      });
      if(mention.highestRole.positon >= message.guild.member(client.user).highestRole.positon) return message.reply('**Ù„Ø§ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ø·Ø±Ø¯ Ø´Ø®Øµ Ø±ØªØ¨ØªÙ‡ Ø§Ø¹Ù„Ù‰ Ù…Ù†ÙŠ**').then(msg => {
        msg.delete(3500);
        message.delete(3500);
      });
      if(mention.id === message.author.id) return message.reply('**Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø·Ø±Ø¯  Ù†ÙØ³Ùƒ**').then(msg => {
        msg.delete(3500);
        message.delete(3500);
      });

       let duration = args[2];
       if(!duration) return message.reply('**Ø­Ø¯Ø¯ ÙˆÙ‚Øª Ø²Ù…Ù†ÙŠ Ù„ÙÙƒ Ø§Ù„Ø¨Ø§Ù† Ø¹Ù† Ø§Ù„Ø´Ø®Øµ**').then(msg => {
         msg.delete(3500);
         message.delete(3500);
       });
       if(isNaN(duration)) return message.reply('**Ø­Ø¯Ø¯ ÙˆÙ‚Øª Ø²Ù…Ù†ÙŠ ØµØ­ÙŠØ­**').then(msg => {
         msg.delete(3500);
         message.delete(3500);
       });

       let reason = message.content.split(" ").slice(3).join(" ");
       if(!reason) reason = 'No reason';

       let thisEmbed = new Discord.RichEmbed()
       .setAuthor(mention.user.username , mention.user.avatarURL)
       .setTitle("You have been banned from a server!")
       .setThumbnail(mention.avatarURL)
       .addField("**# - Server:**",message.guild.name,true)
       .addField("**# - Banned By:**",message.author,true)
       .addField("**# - Reason:**",reason)
       .setFooter(message.author.tag,message.author.avatarURL);
       mention.send(thisEmbed).then(() => {
       mention.ban({
         reason: reason,
       });
       message.channel.send(`**:white_check_mark: ${mention.user.username} banned from the server ! :airplane: **  `)
       setTimeout(() => {
         if(duration === 0) return;
         message.guild.unban(mention);
       },duration * 60000);
     });
   }
});



client.on('message',function(message) {
    let toKick = message.mentions.users.first();
    let toReason = message.content.split(" ").slice(2).join(" ");
    let toEmbed = new Discord.RichEmbed()
   if(message.content.startsWith('Ø§Ø·Ø±Ø¯')) {
       if(!message.member.hasPermission("KICK_MEMBERS")) return message.reply('**# - You dont have enough permissions!**');
       if(toKick.bannable) return message.reply("**# - I cannot kick someone with a higher role than me!**");
       if(!toReason) return message.reply("**# - Supply a reason!**")
       if(toKick.id === message.author.id) return message.reply("**# You cannot kick yourself!**")
       if(!message.guild.member(toKick).bannable) return message.reply("**# - I cannot ban this person!**")
       let toEmbed;
       toEmbed = new Discord.RichEmbed()
       .setTitle("You have been kicked from a server!")
       .setThumbnail(toKick.avatarURL)
       .addField("**# - Server:**",message.guild.name,true)
       .addField("**# - Reason:**",toReason,true)
       .addField("**# - Kicked By:**",message.author,true)
       if(message.member.hasPermission("KICK_MEMBERS")) return (
           toKick.sendMessage({embed: toEmbed}).then(() => message.guild.member(toKick).kick()).then(() => message.channel.send(`**# Done! I kicked: ${toKick}**`))
       )
       }
});

client.on('message', async message => {
  let args = message.content.split(" ");
  if(message.content.startsWith("Ø§Ø®Ø±Øµ")) {
    if(!message.member.hasPermission("MANAGE_ROLES")) return message.reply('**Ø£Ù†Øª Ù„Ø§ ØªÙ…Ù„Ùƒ Ø§Ù„Ø®ØµØ§Ø¦Øµ Ø§Ù„Ù„Ø§Ø²Ù…Ø© . ÙŠØ¬Ø¨ ØªÙˆÙØ± Ø®Ø§ØµÙŠØ© `Manage Roles`**').then(msg => {
      msg.delete(3500);
      message.delete(3500);
    });

    if(!message.guild.member(client.user).hasPermission("MANAGE_ROLES")) return message.reply('**Ø£Ù†Ø§ Ù„Ø§ Ø§Ù…Ù„Ùƒ Ø§Ù„Ø®ØµØ§Ø¦Øµ Ø§Ù„ÙƒØ§ÙÙŠØ© . ÙŠÙ„Ø²Ù… Ø®ØµØ§Ø¦Øµ `Manage Roles` Ù„Ù„Ù‚ÙŠØ§Ù… Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø§Ù…Ø±**').then(msg => {
      msg.delete(3500);
      message.delete(3500);
    });

    let mention = message.mentions.members.first();
    if(!mention) return message.reply('**Ù…Ù†Ø´Ù† Ø¹Ø¶Ùˆ Ù„Ø£Ø³ÙƒØ§ØªÙ‡ ( Ù„Ø£Ø¹Ø·Ø§Ø¦Ø© Ù…ÙŠÙˆØª ) ÙƒØªØ§Ø¨ÙŠ**').then(msg => {
      msg.delete(3500);
      message.delete(3500);
    });

    if(mention.highestRole.position >= message.guild.member(message.author).highestRole.positon) return message.reply('**Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø¹Ø·Ø§Ø¡ Ù„Ù…ÙŠÙˆØª Ø´Ø®Øµ Ø±ØªØ¨ØªÙ‡ Ø§Ø¹Ù„Ù‰ Ù…Ù†Ùƒ**').then(msg => {
      msg.delete(3500);
      message.delete(3500);
    });
    if(mention.highestRole.positon >= message.guild.member(client.user).highestRole.positon) return message.reply('**Ù„Ø§ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ø§Ø¹Ø·Ø§Ø¡ Ù…ÙŠÙˆØª Ù„Ø´Ø®Øµ Ø±ØªØ¨ØªÙ‡ Ø§Ø¹Ù„Ù‰ Ù…Ù†ÙŠ**').then(msg => {
      msg.delete(3500);
      message.delete(3500);
    });
    if(mention.id === message.author.id) return message.reply('**Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø¹Ø·Ø§Ø¡ Ù…ÙŠÙˆØª  Ù„Ù†ÙØ³Ùƒ**').then(msg => {
      msg.delete(3500);
      message.delete(3500);
    });

    let duration = args[2];
    if(!duration) return message.reply('**Ø­Ø¯Ø¯ ÙˆÙ‚Øª Ø²Ù…Ù†ÙŠ Ù„ÙÙƒ Ø§Ù„Ù…ÙŠÙˆØª Ø¹Ù† Ø§Ù„Ø´Ø®Øµ**').then(msg => {
      msg.delete(3500);
      message.delete(3500);
    });

    if(isNaN(duration)) return message.reply('**Ø­Ø¯Ø¯ ÙˆÙ‚Øª Ø²Ù…Ù†ÙŠ ØµØ­ÙŠØ­**').then(msg => {
      msg.delete(3500);
      message.delete(3500);
    });

    let reason = message.content.split(" ").slice(3).join(" ");
    if(!reason) reason = "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";

    let thisEmbed = new Discord.RichEmbed()
    .setAuthor(mention.user.username, mention.user.avatarURL)
    .setTitle('ØªÙ… Ø§ØºØ·Ø§Ø¦Ùƒ Ù…ÙŠÙˆØª Ø¨Ø³ÙŠØ±ÙØ±')
    .setThumbnail(mention.user.avatarURL)
    .addField('# - Ø§Ù„Ø³ÙŠØ±ÙØ±',message.guild.name,true)
    .addField('# - ØªÙ… Ø§Ø¹Ø·Ø§Ø¦Ùƒ Ù…ÙŠÙˆØª Ø¨ÙˆØ§Ø³Ø·Ø©',message.author,true)
    .addField('# - Ø§Ù„Ø³Ø¨Ø¨',reason)

    let role = message.guild.roles.find('name', 'Muted') || message.guild.roles.get(r => r.name === 'Muted');
    if(!role) try {
      message.guild.createRole({
        name: "Muted",
        permissions: 0
      }).then(r => {
        message.guild.channels.forEach(c => {
          c.overwritePermissions(r , {
            SEND_MESSAGES: false,
            READ_MESSAGES_HISTORY: false,
            ADD_REACTIONS: false
          });
        });
      });
    } catch(e) {
      console.log(e.stack);
    }
    mention.addRole(role).then(() => {
      mention.send(thisEmbed);
      message.channel.send(`**:white_check_mark: ${mention.user.username} muted in the server ! :zipper_mouth:  **  `);
      mention.setMute(true);
    });
    setTimeout(() => {
      if(duration === 0) return;
      if(!mention.has.roles(role)) return;
      mention.setMute(false);
      mention.removeRole(role);
      message.channel.send(`**:white_check_mark: ${mention.user.username} unmuted in the server ! :neutral_face:  **  `);
    },duration * 60000);
  } else if(message.content.startsWith(prefix + "unmute")) {
    let mention = message.mentions.members.first();
    let role = message.guild.roles.find('name', 'Muted') || message.guild.roles.get(r => r.name === 'Muted');
    if(!message.member.hasPermission("MANAGE_ROLES")) return message.reply('**Ø£Ù†Øª Ù„Ø§ ØªÙ…Ù„Ùƒ Ø§Ù„Ø®ØµØ§Ø¦Øµ Ø§Ù„Ù„Ø§Ø²Ù…Ø© . ÙŠØ¬Ø¨ ØªÙˆÙØ± Ø®Ø§ØµÙŠØ© `Manage Roles`**').then(msg => {
      msg.delete(3500);
      message.delete(3500);
    });

    if(!message.guild.member(client.user).hasPermission("MANAGE_ROLES")) return message.reply('**Ø£Ù†Ø§ Ù„Ø§ Ø§Ù…Ù„Ùƒ Ø§Ù„Ø®ØµØ§Ø¦Øµ Ø§Ù„ÙƒØ§ÙÙŠØ© . ÙŠÙ„Ø²Ù… Ø®ØµØ§Ø¦Øµ `Manage Roles` Ù„Ù„Ù‚ÙŠØ§Ù… Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø§Ù…Ø±**').then(msg => {
      msg.delete(3500);
      message.delete(3500);
    });

    if(!mention) return message.reply('**Ù…Ù†Ø´Ù† Ø§Ù„Ø´Ø®Øµ Ù„ÙÙƒ Ø§Ù„Ù…ÙŠÙˆØª Ø¹Ù†Ù‡**').then(msg => {
      msg.delete(3500);
      message.delete(3500);
    });

      mention.removeRole(role);
      mention.setMute(false);
      message.channel.send(`**:white_check_mark: ${mention.user.username} unmuted in the server ! :neutral_face:  **  `);
  }
});

  client.on('messageUpdate', (oldRebel, newRebel) => {
   if (newRebel.content.toUpperCase().match(/DISCORD.GG/i))
    {
        console.log(newRebel.author.name + " Ø­Ø§ÙˆÙ„ Ø§Ù„Ù†Ø´Ø± Ø¹Ø¨Ø± ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø±Ø³Ø¢Ù„Ø© - " + newRebel);
           newRebel.delete().catch(O_o=>{}); 
           newRebel.author.send("Ù…Ù…Ù†ÙˆØ¹ Ø±ÙˆØ¢Ø¨Ø· Ø§Ù„Ø¯Ø³ÙƒÙˆØ±Ø¯. \n Ø¥Ø°Ø¢ ÙƒÙ†Øª ØªØ±ÙŠØ¯ Ø§Ù„Ù†Ø´Ø± ØªÙˆØ¢ØµÙ„ Ù…Ù† Ø§Ù„Ø¥Ø¯Ø¢Ø±Ø©.");
    }
});

client.on('message', message => { 
let PREFIX = '?'
    if (message.content.startsWith(prefix + 'emojilist')) {
       message.channel.startTyping();
        const List = message.guild.emojis.map(e => e.toString()).join(" ");

        const EmojiList = new Discord.RichEmbed()
            .setTitle('â  Emojis') 
            .setAuthor(message.guild.name, message.guild.iconURL) 
            .setColor('RANDOM') 
            .setDescription(List) 
            .setFooter(message.guild.name) 
        message.channel.send(EmojiList) 
    }
});


      const arraySort = require('array-sort'),
          table = require('table');

client.on('message' , async (message) => {

    if(message.content.startsWith(prefix + "invites")) {
                 if(message.author.bot) return;
        if(!message.channel.guild) return message.reply(' Error : \` Guild Command \`');

  var invites = await message.guild.fetchInvites();

    invites = invites.array();

    arraySort(invites, 'uses', { reverse: true });

    let possibleInvites = ['User Invited |  Uses '];
    invites.forEach(i => {
        if (i.uses === 0) { 
            return;
            
        }
      possibleInvites.push(['\n\ ' +'<@'+ i.inviter.id +'>' + '  :  ' +   i.uses]);
       
      if (i.uses === 20) {
          message.member.addRole(message.member.guild.roles.find("name","Premuim ,"));
      }
     
    })
    
    const embed = new Discord.RichEmbed()
    .setColor('BLACK')
    .addField("Top Invites." ,`${(possibleInvites)}`)

    message.channel.send(embed)
    }
});


// .................................................................................

var Canvas = require('canvas');// npm i canvas
var jimp = require('jimp');// npm i jimp 

      client.on('guildMemberAdd', member => {
      const welcomer =  member.guild.channels.find('name', 'txt');//Ø§Ø³Ù… Ø§Ù„Ø±ÙˆÙ… Ø§Ù„ÙŠ ÙŠØ±Ø­Ø¨ ÙÙŠÙ‡

      var Canvas = require('canvas')
      var jimp = require('jimp')

      const w = ['./wlc2.png'];

              let Image = Canvas.Image,
                 canvas = new Canvas(497 , 176),
            ctx = canvas.getContext('2d');
        ctx.patternQuality = 'bilinear';
        ctx.filter = 'bilinear';
        ctx.antialias = 'subpixel';
        ctx.shadowColor = 'rgba(0, 0, 0, 0.4)';
        ctx.shadowOffsetY = 2;
        ctx.shadowBlur = 2;
        fs.readFile(`${w[Math.floor(Math.random() * w.length)]}`, function (err, Background) {
            if (err) return console.log(err);
            let BG = Canvas.Image;
            let ground = new Image;
            ground.src = Background;
            ctx.drawImage(ground, 0, 0, 497 , 176);

      })

                let url = member.user.displayAvatarURL.endsWith(".webp") ? member.user.displayAvatarURL.slice(5, -20) + ".png" : member.user.displayAvatarURL;
                jimp.read(url, (err, ava) => {
                    if (err) return console.log(err);
                    ava.getBuffer(jimp.MIME_PNG, (err, buf) => {
                        if (err) return console.log(err);

                        

                        //ur name
                        ctx.font = '20px Arial';
                        ctx.fontSize = '20px';
                        ctx.fillStyle = "#ffffff";
                        ctx.textAlign = "center";
                        ctx.fillText(member.user.username, 170, 140); //shows username!

                        
                        
                                               //Avatar
                        let Avatar = Canvas.Image;
                              let ava = new Avatar;
                              ava.src = buf;
                              ctx.beginPath();
                              ctx.arc(398, 85, 78, 0, Math.PI*4);
                              ctx.closePath();
                              ctx.clip();
                              ctx.drawImage(ava, 308, 8, 173, 173);
				  
				  
 welcomer.sendFile(canvas.toBuffer())



      })
      })
      });


client.on('guildMemberAdd', member => {
  const channel = member.guild.channels.find('name', 'txt');
  if (!channel) return;
  channel.send(`${member}`);
});


var dat = JSON.parse("{}");
function forEachObject(obj, func) {
    Object.keys(obj).forEach(function (key) { func(key, obj[key]) });
}
client.on("ready", () => {
    var guild;
    while (!guild)
        guild = client.guilds.get("419541876769554433");
    guild.fetchInvites().then((data) => {
        data.forEach((Invite, key, map) => {
            var Inv = Invite.code;
            dat[Inv] = Invite.uses;
        });
    });
});



client.on("guildMemberAdd", (member) => {
    let channel = member.guild.channels.get("465850889455009803");
    if (!channel) {
        console.log("!the channel id it's not correct");
        return;
    }
    if (member.id == client.user.id) {
        return;
    }
    console.log('-');
    			 	         var currentTime = new Date(),
		  hours = currentTime.getHours() + 4 ,
          hours2 = currentTime.getHours() + 1 ,             
		   minutes = currentTime.getMinutes(),             
		   seconds = currentTime.getSeconds(),
            Year = currentTime.getFullYear(),
            Month = currentTime.getMonth() + 1,
            Day = currentTime.getDate();
             if(hours2 > 12) {
               hours2 -= 12;
            } else if(hours2 == 0) {
                hours2 = "12";
            
            }  
            var suffix = 'AM';
            if (hours >= 12) {
                suffix = 'PM';
                hours = hours - 12;	
            }
            if (hours == 0) {
                hours = 12;
            }
         var ee = member.user;
    var guild;
    while (!guild)
        guild = client.guilds.get("419541876769554433");
    guild.fetchInvites().then((data) => {
        data.forEach((Invite, key, map) => {
            var Inv = Invite.code;
            if (dat[Inv])
                if (dat[Inv] < Invite.uses) {
 channel.send(`** ØªÙ… Ø§Ù„Ø¯Ø¹ÙˆØ© Ù…Ù† Ù‚Ø¨Ù„ : ${Invite.inviter} **`) ;  

 }
            dat[Inv] = Invite.uses;
       
       });
    });
});

			    
//======================================[Owners]======================================


	

client.login(process.env.TOKEN);
